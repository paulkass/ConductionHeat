<!DOCTYPE html>
<html lang="en">
    <head>
        <title>HackingEDU Project</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="assets/audiolib.js"></script>
		<script src="tuna/tuna.js"></script>
		<script src="MIDI.js/inc/jasmid/midifile.js"></script>
		<script src="MIDI.js/inc/jasmid/stream.js"></script>
		<script src="MIDI.js/inc/jasmid/replayer.js"></script>
		<script src="MIDI.js/inc/shim/Base64.js" type="text/javascript"></script>
		<script src="MIDI.js/inc/shim/Base64binary.js" type="text/javascript"></script>
		<script src="MIDI.js/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
		<script src="MIDI.js/build/MIDI.js" type="text/javascript"></script>
		<script src="MIDI.js/js/util/dom_request_xhr.js" type="text/javascript"></script>
		<script src="MIDI.js/js/util/dom_request_script.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/audioDetect.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/gm.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/loader.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/plugin.audiotag.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/plugin.webaudio.js" type="text/javascript"></script>
		<script src="MIDI.js/js/midi/plugin.webmidi.js" type="text/javascript"></script>
		<!-- // <script src="MIDI.js/js/midi/audiodetect.js" type="text/javascript"></script>
// 		<script src="MIDI.js/js/midi/loadplugin.js" type="text/javascript"></script>
// 		<script src="MIDI.js/js/midi/plugin.js" type="text/javascript"></script>
// 		<script src="MIDI.js/js/midi/player.js" type="text/javascript"></script>
// 		<script src="MIDI.js/js/midi/loader.js" type="text/javascript"></script> -->
    </head>
    <body>
       <h1>HI</h1>
	   <button onClick="player.pause();">Pause</button> 
	   <button onClick="slowdown_player(3);">Slowdown</button>
	           <script>
	  			function loadRemote(path, callback) {
	   				var fetch = new XMLHttpRequest();
	   				fetch.open('GET', path);
	   				fetch.overrideMimeType("text/plain; charset=x-user-defined");
	   				fetch.onreadystatechange = function() {
	   					if(this.readyState == 4 && this.status == 200) {
	   						/* munge response into a binary string */
	   						var t = this.responseText || "" ;
	   						var ff = [];
	   						var mx = t.length;
	   						var scc= String.fromCharCode;
	   						for (var z = 0; z < mx; z++) {
	   							ff[z] = scc(t.charCodeAt(z) & 255);
	   						}
	   						callback(ff.join(""));
	   					}
	   				}
	   				fetch.send();
	   			}
				player = MIDI.player;
				
				
				var mySample = "";
				var tempo = 120,
			    notesPerBeat = 4,
			    tickCounter = 1,
			    tick = 0,
			    dev, sampler;
				var dev, sampler;
				loadRemote("piano_meral.wav", function(data) {
					mySample = atob(btoa(data));
					alert(mySample);
					function audioCallback(buffer, channelCount){
					    // Fill the buffer with the sampler output
					    sampler.append(buffer, channelCount);
					}

					
					    // Create an instance of the AudioDevice class
					    dev = audioLib.AudioDevice(audioCallback /* callback for the buffer fills */, 2 /* channelCount */);
						
					    // Create an instance  of the Sampler class
					    sampler = audioLib.Sampler(dev.sampleRate);
					    // Load the sample to the sampler
					    sampler.loadWav(mySample, true);
						alert(sampler.samples.length);
					    // Trigger the sample
						sampler.addPreProcessing(function(){
								//alert("hi")
						        // Make tickCounter approach 1, and trigger sample when reached
						        
						    });
					
				});
				function slowdown_player(factor) {
					// MIDI.setEffects({
// 						        type: "Delay",
// 						        feedback: 0.45, // 0 to 1+
// 						        delayTime: 150, // how many milliseconds should the wet signal be delayed?
// 						        wetLevel: 0.25, // 0 to 1+
// 						        dryLevel: 1, // 0 to 1+
// 						        cutoff: 20, // cutoff frequency of the built in highpass-filter. 20 to 22050
// 						        bypass: 0
// 						    });

					player.BPM=200;
				}
	   		// $(document).ready(function() {
// 				MIDI.loadPlugin({
// 					soundfontUrl: "assets/midi-js-soundfonts/FluidR3_GM/",
// 					instruments: ["acoustic_grand_piano", "bagpipe"],
// 					onprogress: function(state, progress) {
// 						console.log(state, progress);
// 					},
//     				onsuccess: function() {
// 						// var delay = 1; // play one note every quarter second
// // 						var note = 50; // the MIDI note
// // 						var velocity = 127; // how hard the note hits
// // 									// play the note
// // 						MIDI.setVolume(0, 127);
// // 						MIDI.chordOn(0, [50, 55, 60], velocity, delay);
// // 						MIDI.noteOff(0, note, delay + 0.75);
// 						loadRemote("cathedral.mid", function(data){
// 							 //alert(btoa(data).toString());
// 							 player = MIDI.Player;
// 							 player.timeWarp = 1;
// 							player.loadFile('data:audio/mid;base64, '+btoa(data), player.start, function(){}, function(err){alert(JSON.stringify(err));})
// 						});
// 					}
// 					});
//
// 	   		});
	   		</script>
    </body>
</html>
